{% extends 'submissions/base.html' %}

{% block title %}–ó–¥–∞—Ç–∏ —Ä–æ–±–æ—Ç—É{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card p-3">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="fw-bold mb-0" style="color: #2d3748;">–ó–¥–∞—Ç–∏ —Ä–æ–±–æ—Ç—É</h3>
                <a href="{% url 'submission_success' %}" class="btn btn-outline-info btn-sm">–ó–¥–∞–Ω—ñ —Ä–æ–±–æ—Ç–∏</a>
            </div>
            <form method="post" enctype="multipart/form-data" id="submission-form">
                {% csrf_token %}

                <div class="mb-2">
                    <label class="form-label text-muted small">{{ form.full_name.label }} <span
                            class="text-danger">*</span></label>
                    {{ form.full_name }}
                    <div class="form-text small">–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —ñ–º'—è —á–µ—Ä–µ–∑ –ø—Ä–æ–±—ñ–ª</div>
                </div>

                <div class="mb-2">
                    <label class="form-label text-muted small">–ö–ª–∞—Å <span class="text-danger">*</span></label>
                    {{ form.class_group }}
                </div>

                <div class="mb-2">
                    <label class="form-label text-muted small">–§–∞–π–ª —Ä–æ–±–æ—Ç–∏</label>
                    <div class="drop-zone" id="drop-zone">
                        <div class="drop-zone-content">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                                class="bi bi-cloud-upload mb-1" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z" />
                                <path fill-rule="evenodd"
                                    d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z" />
                            </svg>
                            <p class="mb-1 small">–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª –∞–±–æ</p>
                            <button type="button" class="btn btn-sm btn-outline-primary"
                                onclick="document.getElementById('file-input').click()">–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª</button>
                            <p class="text-muted small mt-1 mb-0" id="file-name"></p>
                        </div>
                    </div>
                    {{ form.file }}
                </div>

                <div class="mb-3">
                    <label class="form-label text-muted small">–ê–±–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</label>
                    {{ form.link }}
                    <div class="form-text small">Google Drive, Docs —Ç–æ—â–æ.</div>
                </div>

                <p class="text-muted small mb-2"><span class="text-danger">*</span> - –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è. –ù–µ–æ–±—Ö—ñ–¥–Ω–æ
                    –ø—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ —Ñ–∞–π–ª –∞–±–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.</p>

                {% if form.errors %}
                <div class="alert alert-danger py-2">
                    {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                    {% endfor %}
                </div>
                {% endif %}

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">–ó–¥–∞—Ç–∏ —Ä–æ–±–æ—Ç—É</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .drop-zone {
        border: 2px dashed #764ba2;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        transition: border-color 0.2s ease, background-color 0.2s ease;
        background: rgba(118, 75, 162, 0.03);
        cursor: pointer;
    }

    .drop-zone:hover {
        background: rgba(118, 75, 162, 0.08);
        border-color: #667eea;
    }

    .drop-zone.dragover {
        background: rgba(118, 75, 162, 0.12);
        border-color: #667eea;
    }

    .drop-zone-content {
        pointer-events: none;
    }

    #file-input {
        display: none;
    }

    .bi-cloud-upload {
        color: #764ba2;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const fileName = document.getElementById('file-name');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropZone.classList.add('dragover');
        }

        function unhighlight(e) {
            dropZone.classList.remove('dragover');
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                fileInput.files = files;
                updateFileName(files[0].name);
            }
        }

        fileInput.addEventListener('change', function (e) {
            if (this.files.length > 0) {
                updateFileName(this.files[0].name);
            }
        });

        function updateFileName(name) {
            fileName.textContent = 'üìé ' + name;
            fileName.style.fontWeight = 'bold';
            fileName.style.color = '#764ba2';
        }

        dropZone.addEventListener('click', function () {
            fileInput.click();
        });
    });
</script>
{% endblock %}